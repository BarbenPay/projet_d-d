version: "2.0"

stories:

- story: welcome path
  steps:
  - intent: start_game
  #Déclenchement du jeu
  - checkpoint: check_setup_loop_start
  #Ici l'utilisateur va revenir sur le choix de la langue si il est pas d'accord avec les settings à partir de la story : path setup denied
  - action: utter_language_selection
  #Le MJ propose les langues
  - intent: language_selection
  #Selection du langage
  - action: utter_accessibility_selection
  #Le MJ propose comment le jeu va etre joué (écrit ou oral)
  - intent: accessibility_selection
  #Selection de accessibility
  - action: utter_confirm_settings_game
  #Recap des paramètres choisis
  - checkpoint: wait_for_confirmation_settings_game

#######################################################################################


- story: path setup confirmed
  steps:
  - checkpoint: wait_for_confirmation_settings_game
  - intent: confirm_settings_game
  - action: utter_start_story_settings
  #Annonce du commencement de la création de personnage
  - checkpoint: start_story_settings
  #Va directement sur les paramètres de l'histoire

- story: path setup denied
  steps:
  - checkpoint: wait_for_confirmation_settings_game
  - intent: denied_settings_game
  - checkpoint: check_setup_loop_start
  #Recommence le welcome path

#######################################################################################


#######################################################################################

- story: story settings
  steps:
  - checkpoint: start_story_settings

  # On active le formulaire
  - action: game_settings_form
  - active_loop: game_settings_form
    #Ici on a la création d'une loop. Tant que l'utilisateur n'a pas rempli les 3 variables (story_theme, story_difficulty, story_players)
    #Donc une création de slot pour stocker les variables. Le bot demande le theme mais comme il est dans la loop la réponse de la difficulty
    #ne fera pas planter le code. Il remplira la variable en le précisant au joueur et redemandera le theme si il n'a pas été donné. 
  - active_loop: null
  - slot_was_set:
    - requested_slot: null

  # Une fois sorti de la boucle, on confirme
  - action: utter_confirm_settings_story
  - checkpoint: wait_for_confirmation_settings_story

#######################################################################################

- story: story settings confirmed
  steps:
  - checkpoint: wait_for_confirmation_settings_story
  - intent: confirm_settings_story 
  - action: utter_start_creation_caracter
  - checkpoint: create_caracter

- story: story settings denied
  steps:
  - checkpoint: wait_for_confirmation_settings_story
  - intent: denied_settings_story 
  - checkpoint: start_story_settings

#######################################################################################


#######################################################################################

- story: character creation
  steps:
  - checkpoint: creat_caracter
  
  #Ici on va rentrer dans la boucle pour faire la création de personnage, dans la meme idée que la story.
  - action: character_creation_form
  - active_loop: character_creation_form
  - active_loop: null
  - slot_was_set:
    - requested_slot: null
  
  #Le formulaire du personnage est fini on appelle le submit character pour enregistrer les slots, les vider et repartir de character_creation_form 
  - action: action_submit_character
  
  - slot_was_set:
    - is_creation_finished: true
    
  - action: utter_all_characters_ready
  - action: utter_start_adventure